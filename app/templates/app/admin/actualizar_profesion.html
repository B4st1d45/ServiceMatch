{% extends 'app/header.html' %}

{% block title %}Actualizar Servicio{% endblock %}

{% block content %}
<div class="container mt-5">
    <h2 class="text-center mb-4">Actualizar Servicio</h2>
    <form method="post">
        {% csrf_token %}
        <!-- Campo para el nombre del servicio -->
        <div class="form-group mb-3">
            <label for="nombre" class="form-label">Nombre del Servicio:</label>
            <input type="text" id="nombre" name="nombre" class="form-control" value="{{ servicio.nombre }}" required>
        </div>

        <!-- Campos para las subcategorías existentes -->
        <h4 class="mt-4">Subcategorías Existentes</h4>
        {% for subcategoria in subcategorias_existentes %}
            <div class="border rounded p-3 mb-3">
                <input type="hidden" name="subcategoria_id_{{ subcategoria.id }}" value="{{ subcategoria.id }}">
                <div class="form-group mb-2">
                    <label for="nombre_{{ subcategoria.id }}" class="form-label">Nombre de la Subcategoría:</label>
                    <input type="text" id="nombre_{{ subcategoria.id }}" name="nombre_{{ subcategoria.id }}" class="form-control" value="{{ subcategoria.nombre }}" required>
                </div>
                <div class="form-group mb-2">
                    <label for="precio_{{ subcategoria.id }}" class="form-label">Precio Base:</label>
                    <div class="input-group">
                        <span class="input-group-text">$</span>
                        <input type="number" step="1" min="0" id="precio_{{ subcategoria.id }}" name="precio_{{ subcategoria.id }}" class="form-control" value="{{ subcategoria.precio_base|floatformat:0 }}" required>
                    </div>
                </div>
                <div class="form-group mb-2">
                    <label for="duracion_{{ subcategoria.id }}" class="form-label">Duración Estimada (horas):</label>
                    <input type="number" id="duracion_{{ subcategoria.id }}" name="duracion_{{ subcategoria.id }}" class="form-control" value="{{ subcategoria.duracion_estimada }}" required>
                </div>
            </div>
        {% endfor %}

        <!-- Sección para agregar nuevas subcategorías -->
        <div class="form-group mb-3">
            <label for="nuevas_subcategorias" class="form-label">Agregar Subcategorías:</label>
            <select id="nuevas_subcategorias" name="nuevas_subcategorias" class="form-control" multiple>
                {% for subcategoria in todas_las_subcategorias %}
                    {% if subcategoria not in subcategorias_existentes %}
                        <option value="{{ subcategoria.id }}">{{ subcategoria.nombre }}</option>
                    {% endif %}
                {% endfor %}
            </select>
            <small class="form-text text-muted">Usa Ctrl (o Cmd en Mac) para seleccionar múltiples subcategorías.</small>
        </div>
    </form>
</div>

<script>
    document.getElementById('agregar-subcategoria').addEventListener('click', function () {
        const container = document.getElementById('nuevas-subcategorias-container');
        const index = container.children.length;
        const subcategoriaHTML = `
            <div class="border rounded p-3 mb-3">
                <div class="form-group mb-2">
                    <label for="nombre_nueva_${index}" class="form-label">Nombre de la Nueva Subcategoría:</label>
                    <input type="text" id="nombre_nueva_${index}" name="nombre_nueva_${index}" class="form-control" required>
                </div>
                <div class="form-group mb-2">
                    <label for="precio_nueva_${index}" class="form-label">Precio Base:</label>
                    <input type="number" step="0.01" id="precio_nueva_${index}" name="precio_nueva_${index}" class="form-control" required>
                </div>
                <div class="form-group mb-2">
                    <label for="duracion_nueva_${index}" class="form-label">Duración Estimada (minutos):</label>
                    <input type="number" id="duracion_nueva_${index}" name="duracion_nueva_${index}" class="form-control" required>
                </div>
            </div>
        `;
        container.insertAdjacentHTML('beforeend', subcategoriaHTML);
    });
</script>

{% endblock %}

{% include 'app/footer.html' %}
