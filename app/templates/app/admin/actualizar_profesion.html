{% extends 'app/header.html' %}

{% block title %}Actualizar Servicio{% endblock %}

{% block content %}
<div class="container mt-5">
    <h2 class="text-center mb-4">Actualizar Servicio</h2>
    <form method="post">
        {% csrf_token %}

        <div class="form-group mb-3">
            <label for="nombre" class="form-label">Nombre del Servicio:</label>
            <input type="text" id="nombre" name="nombre" class="form-control" value="{{ servicio.nombre }}" required>
        </div>

        <div class="form-group mb-3">
            <label for="subcategoria-select" class="form-label">Selecciona Subcategoría para Editar:</label>
            <select id="subcategoria-select" class="form-control">
                <option value="" disabled selected>Selecciona una subcategoría</option>
                {% for subcategoria in subcategorias_existentes %}
                        <option value="{{ subcategoria.id }}">{{ subcategoria.nombre }}</option>
                {% endfor %}
            </select>
        </div>

        <div id="subcategoria-fields" class="border rounded p-3 mb-3" style="display: none;">
            <input type="hidden" id="subcategoria-id" name="subcategoria_id">

            <div class="form-group mb-2">
                <label for="subcategoria-nombre" class="form-label">Nombre de la Subcategoría:</label>
                <input type="text" id="subcategoria-nombre" name="subcategoria_nombre" class="form-control">
            </div>

            <div class="form-group mb-2">
                <label for="subcategoria-precio" class="form-label">Precio Base:</label>
                <div class="input-group">
                    <span class="input-group-text">$</span>
                    <input type="number" step="1" min="0" id="subcategoria-precio" name="subcategoria_precio" class="form-control">
                </div>
            </div>

            <div class="form-group mb-2">
                <label for="subcategoria-duracion" class="form-label">Duración Estimada (horas):</label>
                <input type="number" id="subcategoria-duracion" name="subcategoria_duracion" class="form-control">
            </div>
        </div>

        <button type="button" id="add-subcategory-btn" class="btn btn-secondary mt-3">Añadir Subcategoría</button>
        <div id="new-subcategory-fields" class="border rounded p-3 mt-3" style="display: none;">
            <h5>Nueva Subcategoría</h5>
            <div class="form-group mb-2">
                <label for="nueva-subcategoria-nombre" class="form-label">Nombre de la Subcategoría:</label>
                <input type="text" name="nueva_subcategoria_nombre" class="form-control">
            </div>

            <div class="form-group mb-2">
                <label for="nueva-subcategoria-precio" class="form-label">Precio Base:</label>
                <div class="input-group">
                    <span class="input-group-text">$</span>
                    <input type="number" step="1" min="0" name="nueva_subcategoria_precio" class="form-control">
                </div>
            </div>

            <div class="form-group mb-2">
                <label for="nueva-subcategoria-duracion" class="form-label">Duración Estimada (horas):</label>
                <input type="number" name="nueva_subcategoria_duracion" class="form-control">
            </div>
        </div>

        <button type="submit" class="btn btn-primary mt-3">Actualizar Servicio</button> 
    </form>
</div>

<script>
    const select = document.getElementById('subcategoria-select');
    const fieldsContainer = document.getElementById('subcategoria-fields');
    const subcategoriaIdField = document.getElementById('subcategoria-id');
    const subcategoriaNombreField = document.getElementById('subcategoria-nombre');
    const subcategoriaPrecioField = document.getElementById('subcategoria-precio');
    const subcategoriaDuracionField = document.getElementById('subcategoria-duracion');

    const subcategorias = [
        {% for subcategoria in subcategorias_existentes %}
        {
            id: "{{ subcategoria.id }}",
            nombre: "{{ subcategoria.nombre }}",
            precio: "{{ subcategoria.precio_base|floatformat:0 }}",
            duracion: "{{ subcategoria.duracion_estimada }}"
        },
        {% endfor %}
    ];

    select.addEventListener('change', function() {
        const selectedId = this.value;
        const subcategoria = subcategorias.find(s => s.id === selectedId);
        
        if (subcategoria) {
            fieldsContainer.style.display = 'block';
            subcategoriaIdField.value = subcategoria.id;
            subcategoriaNombreField.value = subcategoria.nombre;
            subcategoriaPrecioField.value = subcategoria.precio;
            subcategoriaDuracionField.value = subcategoria.duracion;
        }
    });

    const addSubcategoryBtn = document.getElementById('add-subcategory-btn');
    const newSubcategoryFields = document.getElementById('new-subcategory-fields');

    addSubcategoryBtn.addEventListener('click', function() {
        newSubcategoryFields.style.display = newSubcategoryFields.style.display === 'none' ? 'block' : 'none';
    });
</script>

{% endblock %}

{% include 'app/footer.html' %}